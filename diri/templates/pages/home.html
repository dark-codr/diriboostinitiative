{% extends "base.html" %}
{% load i18n crispy_forms_tags %}

{% block head %}
{{ wizard.form.media }}
{% endblock head %}

{% block content %}
{% include 'includes/hero.html' %}
<main id="content">
  <div class="content-wrap py-0">
    <div id="section-about" class="page-section">

      <div class="container clearfix">

        <div class="mx-auto topmargin bottommargin-lg" style="max-width: 850px;">
          <div class="container">
            <h2 class="bottommargin-sm">Verify For DiriBoost</h2>

            <p>Step {{ wizard.steps.step1 }} of {{ wizard.steps.count }}</p>
            <form id="sub-form" action="{% url 'home' %}" method="POST" enctype="multipart/form-data">{% csrf_token %}
              <script src="https://js.paystack.co/v1/inline.js"></script>
              <div class="row">
                {% if wizard.form.non_field_errors %}
                <div role="alert" class="alert alert-danger">
                  {% for error in wizard.form.non_field_errors %}
                  {{error}}
                  {% endfor %}
                </div>
                {% endif %}
                {{ wizard.management_form }}
                {% if wizard.form.forms %}
                {{ wizard.form.management_form }}
                {% for form in wizard.form.forms %}
                {% crispy form %}
                {% endfor %}
                {% else %}
                {{ wizard.form }}
                {% endif %}
              </div>

              {% if wizard.steps.next %}
              <input class="btn-block button button-border button-circle font-weight-medium ml-0 topmargin-sm" type="submit"
              value="{% trans " NEXT" %}" />
              {% endif %}
              {% if wizard.steps.last and not wizard.steps.next %}
              <input onclick="payWithPaystackOrg()" id="pay"
                class="btn-block button button-border button-circle font-weight-medium ml-0 topmargin-sm" type="submit"
                value="{% trans " SUBMIT" %}" />
              {% endif %}
              {% if wizard.steps.prev %}
              <button type="submit"
                class="btn-block button button-border button-circle font-weight-medium ml-0 topmargin-sm"
                name="wizard_goto_step" value="{{ wizard.steps.prev }}">{% trans "PREVIOUS" %}</button>
              {%endif %}
            </form>

          </div>
        </div>

      </div>
    </div>

  </div>
</main>
{% endblock content %}

{% block inline_javascript %}
<script>
  $('input#pay').click(function payWithPaystackOrg(e) {
    var email = $("#id_2-email").val();
    var phone = $("#id_2-phone").val();
    var fname = $("#id_0-first_name").val();
    var lname = $("#id_0-last_name").val();

    e.preventDefault();
    var handler = PaystackPop.setup({
      key: 'pk_live_16432e86d97009113cb2aa7fd4ee59df8d570202',//"pk_test_bbf939ac50083a6842f9a88433cf6ba690b9ca09",//
      email: email,
      amount: "100000",
      currency: "NGN",
      split_code: "SPL_ZecNHCnDbi",//"SPL_OVrykLLxU4",//
      ref: "DIRIBOOST_" + Math.floor((Math.random() * 1000000000) + 1),
      metadata: {
        firstname: fname,
        lastname: lname,
        custom_fields: [
          {
            display_name: "Mobile Number",
            variable_name: "mobile_number",
            value: phone
          },
          {
            display_name: "Full Name",
            variable_name: "full_name",
            value: fname + " " +lname
          }
        ]
      },
      callback: function (response) {
        alert('successfully registered with transaction ref: ' + response.reference);
        $('form').unbind('submit').submit();
      },
      onClose: function () {
        alert('Transaction Terminated');
      }
    });
    handler.openIframe();
  });
</script>
{% endblock inline_javascript %}